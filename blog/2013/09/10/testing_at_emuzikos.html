<!doctype html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Testing at Emuzikos: a BDD story Site officiel</title><meta name=google-site-verification content=7Sm0TNkbdPiVI19igcgIRPadP14LheItev30UZxtkuM><meta name=description content=""><meta name=viewport content="width=device-width, initial-scale=1"><!-- Place favicon.ico and apple-touch-icon(s) in the root directory --><link rel=stylesheet href=/css/main.7cd6.css><script src=/js/modernizr.d41d.js></script></head><body data-spy=scroll data-target=.fixed-sidebar><!--[if lt IE 8]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]--><nav class="navbar navbar-default navbar-static-top navbar-inverse" role=navigation><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-nav><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button></div><div class="collapse navbar-collapse" id=main-nav><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href=/projects/index.html>Projects</a></li><li><a href=/blog/index.html>Blog</a></li></ul></div></div></nav><div class=container><div class=row><div class=col-md-8><article class=post><div class="page-header post--header"><h1 class="">Testing at Emuzikos: a BDD story</h1></div><h2 id=context>Context</h2><p>A month ago, when I started using codeship I didn’t realize how more worry-free my designer/developper life could be. I came across continuous integration testing a year ago when I started to work on a big social network application (<a href=http://trustedfamily.net>TrustedFamily</a>). They were already 3 developpers working on differents features and because of code security policies were using <a href="http://http://jenkins-ci.org/">Jenkins CI</a>. Around that time I started to build, as a side project, a musicians searching app (<a href=http://emuzikos.com>Emuzikos</a>). As a musician I always thought that these musicians forums were a pain when it comes to searching for other people and as designer/developper I found that building an app would be more gratifying and easier to maintain than an constantly outdated portfolio.</p><p>Working on a side project also mean you have small chunks of time to work on your app. Here more than ever the agile methodology make sense: split your projects tasks into some smaller one and isolated one that match the time frames you’re working in.</p><p>Idealy you want to test each of these small releases, so that when you push your code you make sure you don’t break the entire app.</p><p>So here is the workflow I’ve put in place to optimize my output.</p><h2 id=the-tools>The tools</h2><h3 id=spinach-a-cucumber-without-regex>Spinach, a Cucumber without regex</h3><p>I recently discovered <a href="http://codegram.github.io/spinach/">Spinach</a>: a BDD framework written in pure Ruby that features encapsulation and modularity of your step definitions.</p><p>I used to work only with rpsec and steak but felt that I was missing some clarity about what the app is supposed to do at a glance (and other reasons described <a href=http://blog.codegram.com/2011/10/how-to-achieve-more-clean-encapsulated-modular-step-definitions-with-spinach>here</a>). I wanted to switch to a gherkin style integration testing framework.</p><p>So for each feature that I build, I write an integration test that describes the big picture. Coming from rspec you, at first, often tend to replicate the capybara steps in gherkin, which leads to unreadable specs and makes them impossible to transmit to any shareholder or even yourself when you have to fix bugs. It’s also very tedious to maintain because you have to change the code at two places each time you change a class or some text.</p><p>So there is no point to start speaking about technicalities (like clicks, fill-in inputs, …) when you describe a behaviour.</p><div class=highlight><pre><code class=cucumber><span class=c>#### Bad</span><span class=nf></span>

<span class=k>Feature:</span><span class=nf> Testimonials</span>
<span class=nf>  </span><span class=k>Background:</span><span class=nf></span>
<span class=k>    Given </span><span class=nf>I go the login page </span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I fill in email with john@doe.com</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I fill in password with </span><span class=s>1234</span><span class=nf></span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I click the submit button</span>

<span class=nf>  </span><span class=k>Scenario:</span><span class=nf> Create a new testimonial with valid data</span>
<span class=k>    Given </span><span class=nf>I go to the new testimonials page</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I fill in body with &#39;Cool App dude!&#39;</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I click the submit button</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I log in as an admin</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I go the testonial page</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I approve the testimonial</span>
<span class=nf>    …</span>
<span class=nf>    ZZzzzzzzz</span>

<span class=c>#### Good</span><span class=nf></span>

<span class=k>Feature:</span><span class=nf> Testimonials</span>
<span class=nf>  </span><span class=k>Background:</span><span class=nf></span>
<span class=k>    Given </span><span class=nf>I am logged in</span>

<span class=nf>  </span><span class=k>Scenario:</span><span class=nf> Create a new testimonial with valid data</span>
<span class=k>    When </span><span class=nf>I go to the new testimonials page</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>I submit the form</span>
<span class=nf>    </span><span class=k>And </span><span class=nf>it is approved by an admin</span>
<span class=nf>    </span><span class=k>Then </span><span class=nf>I should see the testimonial on the index page</span></code></pre></div><p>Then you do all the capybara, phantomjs magic in your steps file. You get the thing …</p><h3 id=zeus>Zeus</h3><p>In order to gain some time when writing code that incrementely make the tests pass, I’using <a href=https://github.com/burke/zeus>Zeus</a> to preload the rails environement or more technically: Zeus is a language-agnostic application checkpointer for non-multithreaded applications. That in addition to <a href="http://livereload.com/">Livereload</a> is a must!</p><h2 id=continuous-integration-codeship-to-the-rescue>Continuous Integration: CodeShip to the rescue</h2><p>As your test suite grows you don’t want to wait all the tests to pass locally before comitting something. So that’s where Codeship becomes a very useful tool.</p><p>As you develop a new feature:</p><div class=highlight><pre><code class=bash>git flow feature start awesome_feature
zeus start</code></pre></div><ul><li>write your feature specific specs</li><li>write the code to make the feature specific tests pass</li></ul><div class=highlight><pre><code class=bash>git commit -am <span class=s2>&quot;Fix the tests&quot;</span>
git flow feature finish awesome_feature // which will nmerge it back to dev
git push // make sure develop has a deployment method to a staging server</code></pre></div><ul><li>check if the full test suite passes in codeship and send staging server to user-testing or client for getting feedback</li><li>fix the eventual bugs until the tests are all green</li></ul><div class=highlight><pre><code class=bash>git flow release start new_set_of_features // so you get the version tag and all</code></pre></div><ul><li>you can still do some commit at this point</li></ul><div class=highlight><pre><code class=bash>git flow release finish new_set_of_features
git push</code></pre></div><ul><li>let the test run on Codeship.</li><li>let Codeship deploy for you.</li><li>grab a beer, celebrate!</li></ul><h2 id=conclusions>Conclusions</h2><p>Continuous integration really makes it easy to find out which commit broke your app and quickly revert your code to the previous one. Also, If you work using git-flow you can create realease branches, test them and deploy them separately, allowing you to make last fixes while other developpers can continue working on new stuff.</p><p>Suppose you have a full test suite, you get warnings of conflicting changes much more early in the release process. That practically gives you an almost always stable branch for staging demos, releases …</p><p>I could also immagine that at some point, CI could be integrated with some kind of quality tools like <a href=https://codeclimate.com>Code Climate</a> and make the tests fail if the code quality drops under a certain rating.</p><div class=pager><li class=disabled><a><i class=icon-left-open></i> Previous article</a></li><li><a href=/blog/2014/04/11/simple-static-html-partials-includes-with-yeoman-and-gruntjs.html title="Simple static html partials includes with yeoman and grunt.js" rel=tooltip>Next article <i class=icon-right-open></i></a></li></div><div id=disqus_thread></div><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
              var disqus_shortname = 'rorsvort-site'; // required: replace example with your forum shortname

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><div class="col-md-4 home-section hidden-xs"><ul class=social_medias><li><a href=http://twitter.com/borisrorsvort class="btn btn-default btn-xs" title="Follow me on Twitter" data-placement=bottom rel="external no-follow tooltip"><i class=icon-twitter></i></a></li><li><a href=http://github.com/borisrorsvort class="btn btn-default btn-xs" title="View my Github profile" data-placement=bottom rel="external no-follow tooltip"><i class=icon-github></i></a></li><li><a href=http://linkedin.com/in/borisrorsvort class="btn btn-default btn-xs" title="View my LinkedIn profile" data-placement=bottom rel="external no-follow tooltip"><i class=icon-linkedin></i></a></li><li><a href=/docs/borisrorsvort-vcard.vcf class="btn btn-default btn-xs" title="Download my vCard" data-placement=bottom rel="external no-follow tooltip"><i class=icon-user></i></a></li><li><a href=http://weblog.rorsvort.com class="btn btn-default btn-xs" title="Read my blog" data-placement=bottom rel="external no-follow tooltip"><i class=icon-rss></i></a></li><li><a href=http://dribbble.com/borisrorsvort class="btn btn-default btn-xs" title="View my dribbble profile" data-placement=bottom rel="external no-follow tooltip"><i class=icon-dribbble></i></a></li></ul><header><h3>Latest Articles</h3></header><div class=home-section--article><div class="home-section--article--date text-muted">September 21, 2014</div><a href=/blog/2014/09/21/lean_ux.html>Change from a culture of shipping to a culture of learning</a></div><div class=home-section--article><div class="home-section--article--date text-muted">April 11, 2014</div><a href=/blog/2014/04/11/simple-static-html-partials-includes-with-yeoman-and-gruntjs.html>Simple static html partials includes with yeoman and grunt.js</a></div><div class=home-section--article><div class="home-section--article--date text-muted">September 10, 2013</div><a href=/blog/2013/09/10/testing_at_emuzikos.html>Testing at Emuzikos: a BDD story</a></div><header><h3>Side Projects</h3></header><div class=home-section--article><a href=http://www.rorsvort.com/projects/emuzikos.html>Emuzikos: the first easy way to find local musicians</a></div><div class=home-section--article><a href=http://www.rorsvort.com/projects/mycollecto.html>MyCollecto: searching nearby Collecto taxi points</a></div></div></div></div><script src=/js/application.1ea0.js></script><script src=/js/plugins.1a15.js></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='//www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-2826331-2');ga('send','pageview');</script><script>//   (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
//     function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
//   e=o.createElement(i);r=o.getElementsByTagName(i)[0];
//   e.src='//www.google-analytics.com/analytics.js';
//   r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
//   ga('create','UA-2826331-18');ga('send','pageview');</script></body></html>